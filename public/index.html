<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Image Restore Studio</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.2/dist/cropper.min.css" />
    <link rel="stylesheet" href="/styles.css?v=__ASSET_VERSION__" />
  </head>
  <body>
    <main class="app-shell">
      <div class="language-toggle-wrap">
        <label id="languageLabel" for="languageToggle">Language</label>
        <select id="languageToggle" aria-label="Language">
          <option value="en">English</option>
          <option value="vi">Tiếng Việt</option>
        </select>
      </div>
      <header class="hero">
        <h1 id="heroTitle">Image Restore Studio</h1>
        <p id="heroSubtitle">Upload, restore, compare, and download your photos.</p>
      </header>

      <section id="panelAccount" class="panel">
        <div id="accountHead" class="account-head">
          <h2 id="accountTitle">Account</h2>
          <button id="register" class="ghost subtle-btn">Register</button>
        </div>
        <div id="authGuest" class="grid-3">
          <input id="email" type="email" placeholder="Email" />
          <div class="password-field">
            <input id="password" type="password" placeholder="Password" />
            <button id="toggleLoginPassword" type="button" class="password-toggle ghost" aria-label="Show Password" title="Show Password">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 5c5.3 0 9.7 3.8 11 7-1.3 3.2-5.7 7-11 7s-9.7-3.8-11-7c1.3-3.2 5.7-7 11-7zm0 2C8 7 4.5 9.7 3.2 12 4.5 14.3 8 17 12 17s7.5-2.7 8.8-5C19.5 9.7 16 7 12 7zm0 2.5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5z"/>
              </svg>
            </button>
          </div>
          <div class="btn-row">
            <button id="login">Login</button>
          </div>
        </div>
        <p id="authMessage" class="auth-message" hidden></p>
        <div id="authUser" class="account-user" hidden>
          <span id="accountLabel"></span>
          <div class="account-actions">
            <a id="adminLink" class="ghost admin-link" href="/admin.html" hidden>Admin</a>
            <button id="logout" class="danger">Logout</button>
          </div>
        </div>
      </section>

      <section id="panelUpload" class="panel auth-only">
        <h2 id="uploadTitle">Upload Image</h2>
        <div class="grid-3">
          <div class="file-picker">
            <label id="filePickerBtn" for="photo" class="ghost">Choose File</label>
            <span id="filePickerName">No file chosen</span>
            <input id="photo" type="file" accept="image/*" class="file-input-hidden" />
          </div>
        </div>
      </section>

      <section id="panelImages" class="panel auth-only">
        <div class="panel-head">
          <h2 id="yourImagesTitle">Your Images</h2>
          <span id="yourImagesCount" class="section-count">Total Images: 0</span>
          <div class="btn-row">
            <button id="toggleMetadata" class="ghost subtle-btn" type="button">Hide Image Info</button>
            <button id="refresh" class="icon-btn ghost" aria-label="Refresh Library" title="Refresh Library">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5a7 7 0 0 1 6.65 4.8H21l-3.4 3.9-3.6-3.9h2.6A5 5 0 1 0 17 14h2a7 7 0 1 1-7-9z"/></svg>
            </button>
          </div>
        </div>
        <ul id="images" class="image-list"></ul>
      </section>

      <section id="panelSharedImages" class="panel auth-only">
        <div class="panel-head">
          <h2 id="sharedImagesTitle">Shared Images</h2>
          <span id="sharedImagesCount" class="section-count">Total Images: 0</span>
          <button id="toggleSharedLayout" class="ghost subtle-btn" type="button">Layout: Tile</button>
          <button id="toggleMetadataShared" class="ghost subtle-btn" type="button">Hide Caption</button>
        </div>
        <ul id="sharedImages" class="image-list shared-image-grid"></ul>
      </section>

      <div id="noticeModal" class="notice-modal" hidden>
        <div class="notice-dialog">
          <h3 id="noticeTitle">Notification</h3>
          <p id="noticeMessage"></p>
          <div class="notice-actions">
            <button id="noticeClose" class="ghost">Close</button>
          </div>
        </div>
      </div>
      <div id="confirmModal" class="notice-modal" hidden>
        <div class="notice-dialog">
          <h3 id="confirmTitle">Confirm Action</h3>
          <p id="confirmMessage"></p>
          <div class="notice-actions confirm-actions">
            <button id="confirmCancel" class="ghost">Cancel</button>
            <button id="confirmOk" class="danger">Confirm</button>
          </div>
        </div>
      </div>
      <div id="registerModal" class="notice-modal" hidden>
        <div class="notice-dialog">
          <h3 id="registerTitle">Create Account</h3>
          <div class="grid-3">
            <input id="registerEmail" type="email" placeholder="Email" />
            <input id="registerPassword" type="password" placeholder="Password (min 8 chars)" />
            <input id="registerPasswordConfirm" type="password" placeholder="Confirm Password" />
          </div>
          <p id="registerMessage" class="auth-message" hidden></p>
          <div class="notice-actions confirm-actions">
            <button id="registerCancel" class="ghost">Cancel</button>
            <button id="registerSubmit">Register</button>
          </div>
        </div>
      </div>
      <div id="forcePasswordModal" class="notice-modal" hidden>
        <div class="notice-dialog">
          <h3 id="forcePasswordTitle">Change Password Required</h3>
          <p id="forcePasswordHint">For security, you must change your temporary password before continuing.</p>
          <div class="grid-3">
            <input id="forceCurrentPassword" type="password" placeholder="Current Password" />
            <input id="forceNewPassword" type="password" placeholder="New Password (min 8 chars)" />
            <input id="forceConfirmPassword" type="password" placeholder="Confirm New Password" />
          </div>
          <div class="notice-actions confirm-actions">
            <button id="forcePasswordSubmit">Update Password</button>
            <button id="forcePasswordLogout" class="ghost">Logout</button>
          </div>
        </div>
      </div>
      <div id="versionHoverPopup" class="version-hover-popup" hidden>
        <img id="versionHoverImage" alt="Version preview" />
      </div>

      <div id="enhanceModal" class="enhance-modal" hidden>
        <div class="enhance-dialog">
          <div class="enhance-header">
            <h3 id="enhanceTitle">Image Enhancement</h3>
          </div>

          <div class="enhance-controls">
            <div class="enhance-row top-row">
              <label class="control-check"><input id="face" type="checkbox" checked /> Face Restore</label>
              <label class="control-check"><input id="colorize" type="checkbox" /> Colorize (DeOldify)</label>
              <label class="control-check"><input id="upscale" type="checkbox" /> Resize (4x)</label>
              <label class="control-check"><input id="resize" type="checkbox" /> Resize (Custom)</label>

              <label class="slider-wrap compact">
                <span class="slider-title">Width</span>
                <input id="targetWidth" type="number" min="1" step="1" placeholder="Width" />
              </label>
              <label class="slider-wrap compact">
                <span class="slider-title">Height</span>
                <input id="targetHeight" type="text" placeholder="auto" />
              </label>
            </div>

            <div class="enhance-row bottom-row">
              <label class="slider-wrap compact">
                <span class="slider-title">Face Strength: <b id="faceStrengthValue">0.7</b></span>
                <input id="faceStrength" type="range" min="0.1" max="1.0" step="0.1" value="0.7" />
              </label>
              <label class="slider-wrap compact">
                <span class="slider-title">Sharpen: <b id="sharpenValue">0.0</b></span>
                <input id="sharpen" type="range" min="0" max="2" step="0.1" value="0" />
              </label>
              <label class="slider-wrap compact">
                <span class="slider-title">Contrast: <b id="contrastValue">1.0</b></span>
                <input id="contrast" type="range" min="0.5" max="2.5" step="0.1" value="1" />
              </label>
              <label class="slider-wrap compact">
                <span class="slider-title">Saturation: <b id="saturationValue">1.0</b></span>
                <input id="saturation" type="range" min="0.5" max="2.5" step="0.1" value="1" />
              </label>
              <label class="slider-wrap compact">
                <span class="slider-title">Brightness: <b id="gammaValue">1.0</b></span>
                <input id="gamma" type="range" min="0.5" max="2.5" step="0.1" value="1" />
              </label>
              <label class="slider-wrap compact">
                <span class="slider-title">Denoise: <b id="denoiseValue">0</b></span>
                <input id="denoise" type="range" min="0" max="20" step="1" value="0" />
              </label>
            </div>
          </div>

          <div id="progressWrap" class="progress-wrap" hidden>
            <div class="progress-head">
              <span id="progressLabel">Processing...</span>
              <span id="progressPercent">0%</span>
            </div>
            <div class="progress-track">
              <div id="progressBar" class="progress-bar"></div>
            </div>
          </div>

          <div class="preview-grid">
            <article class="preview-card">
              <h3 id="originalTitle">Original</h3>
              <div class="preview-frame"><img id="uploadedPreview" alt="Uploaded preview" /></div>
              <p id="beforeSize" class="meta-line">Size: -</p>
            </article>
            <article class="preview-card">
              <h3 id="enhancedTitle">Enhanced</h3>
              <div class="preview-frame"><img id="completedPreview" alt="Completed preview" /></div>
              <p id="afterSize" class="meta-line">Size: -</p>
            </article>
          </div>

          <div class="enhance-actions">
            <button id="closeEnhanceModal" class="ghost">Cancel</button>
            <button id="useEnhancedBtn" class="ghost">Save Enhanced Version</button>
            <button id="resetAdjustmentsBtn" class="ghost">Reset All Settings</button>
            <button id="process">Generate Preview</button>
          </div>
        </div>
      </div>

      <div id="cropModal" class="crop-modal" hidden>
        <div class="crop-dialog">
          <h3 id="cropTitle">Upload Image</h3>
          <div class="crop-body">
            <div class="crop-image-wrap">
              <img id="cropImage" alt="Crop source" />
            </div>
            <div class="crop-preview-wrap">
              <p id="cropPreviewTitle">Preview</p>
              <div id="cropPreview" class="crop-preview"></div>
            </div>
          </div>
          <div class="crop-tools">
            <span id="cropRotateLabel" class="crop-tools-label">Rotate</span>
            <button id="cropRotateLeft" type="button" class="ghost">Rotate Left</button>
            <button id="cropRotateRight" type="button" class="ghost">Rotate Right</button>
            <label class="crop-rotate-slider-wrap" for="cropRotateSlider">
              <span id="cropOrientationLabel" class="crop-tools-label">Orientation: <b id="cropRotateValue">0°</b></span>
              <input id="cropRotateSlider" type="range" min="-180" max="180" step="1" value="0" />
            </label>
          </div>
          <div class="crop-caption-row">
            <label id="cropCaptionLabel" for="cropCaptionInput">Caption</label>
            <input id="cropCaptionInput" type="text" placeholder="Image caption (optional)" maxlength="1000" />
          </div>
          <div class="crop-actions">
            <button id="cropCancel" class="ghost">Cancel</button>
            <button id="cropApply" class="ghost">Apply Crop</button>
            <button id="cropUseOriginal">Use Original</button>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.2/dist/cropper.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/app.js?v=__ASSET_VERSION__"></script>
  </body>
</html>
